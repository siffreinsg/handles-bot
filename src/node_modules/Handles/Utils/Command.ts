import * as fs from 'fs'
import * as path from 'path'
import * as Discord from 'discord.js'
import Arguments from 'Handles/Utils/Arguments'
import Context from 'Handles/Command/CommandContext'


/**
 * Execute an command.
 * 
 * @param message Discord Message object of command
 * @param commandName Command name
 * @param args Arguments of command
 */
export function execute(message: Discord.Message, commandName: string, args: any) {
    commandName = commandName.toLowerCase()
    if (commandName !== '') {
        if (app.commands.list.indexOf(commandName) !== -1) {
            let requiredArgs = app.commands.cmds[commandName].args
            let givedArgs = new Arguments(args)
            let isValid = true

            requiredArgs.forEach((arg, index) => {
                let givedArg = givedArgs.get(index)
                if (!givedArg && arg.required) isValid = false
            })

            if (isValid) return app.commands.cmds[commandName].execute(new Context(message), givedArgs)
            else {
                let embed = new Discord.RichEmbed()
                    .setColor('#cc0000')
                    .setFooter(app.translate('/errors/requestedBy', message.guild.id, { user: message.author.tag }), message.author.avatarURL)
                    .addField(app.translate('/errors/badArgs', message.guild.id), app.translate('/errors/learnCMD', message.guild.id))
                message.channel.send('', embed)
            }
        } else {
            return 'notfound'
        }
    }
}
