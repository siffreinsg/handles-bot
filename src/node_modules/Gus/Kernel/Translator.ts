import * as path from 'path'

export default class Translator {
    langsPath : string = '../../../app/langs/'
    langContent : any = {}
    lang : string

    constructor(lang) {
        this.lang = lang
        try {
            this.langContent = require(path.resolve(__dirname, this.langsPath, lang + '.json'))
        } catch (ex) {
            throw new Error('Unreachable language file (' + lang + ')')
        }
    }

    translate(path: string, tags: {[key: string]: string} = {}) : string {
        try {
            let result = this.langContent, go = path.split('/')
            go.shift()

            go.forEach(function (value) {
                result = result[value]
            })
            for (var key in tags){
                key = key.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&') // Regex escape

                result = result.replace(new RegExp('{' + key + '}', 'g'), tags[key])
            }
            return result
                .replace(new RegExp('{prefix}', 'g'), app.config.prefix)
                .replace(new RegExp('{botname}', 'g'), app.config.botname)
                .replace(new RegExp('{version}', 'g'), app.config.version)
                .replace(new RegExp('{lang}', 'g'), this.lang)
                .replace(new RegExp('{invite_url}', 'g'), app.invite_url)

        } catch (ex) {
            throw new Error('Unable to access translation! Lang: ' + this.lang + ', Path: ' + path)
        }
    }
}
